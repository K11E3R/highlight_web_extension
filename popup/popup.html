<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Highlighter</title>
  <link rel="stylesheet" href="popup.css">
</head>
<body>
  <div class="app">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <div class="brand">
          <button id="brandIcon" class="brand-icon" title="Toggle Quick Mode" aria-label="Toggle quick mode">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 19l7-7 3 3-7 7-3-3z"/>
              <path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"/>
            </svg>
          </button>
        </div>
      </div>
      
      <nav class="sidebar-nav">
        <button id="viewPageBtn" class="nav-item active" data-tooltip="This Page" title="This Page" aria-label="View this page highlights">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
            <polyline points="14 2 14 8 20 8"/>
          </svg>
        </button>
        <button id="viewAllBtn" class="nav-item" data-tooltip="All Pages" title="All Pages" aria-label="View all highlights">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="3" width="7" height="7"/>
            <rect x="14" y="3" width="7" height="7"/>
            <rect x="14" y="14" width="7" height="7"/>
            <rect x="3" y="14" width="7" height="7"/>
          </svg>
        </button>
        
        <div class="nav-divider"></div>
        
        <!-- Dashboard -->
        <button id="dashboardBtn" class="nav-item" data-tooltip="Dashboard" title="Dashboard" aria-label="View statistics">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M18 20V10"/>
            <path d="M12 20V4"/>
            <path d="M6 20v-6"/>
          </svg>
        </button>
        
        <!-- Favorites -->
        <button id="favoritesBtn" class="nav-item" data-tooltip="Favorites" title="Favorites" aria-label="View favorites">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
          </svg>
        </button>
        
        <div class="nav-item-wrapper">
          <button id="categoriesBtn" class="nav-item has-badge" data-tooltip="Categories" title="Categories" aria-label="View categories">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"/>
              <line x1="7" y1="7" x2="7.01" y2="7"/>
            </svg>
            <span class="nav-badge" id="categoryBadge">0</span>
          </button>
          
          <!-- Category Dropdown -->
          <div id="categoryDropdown" class="category-dropdown hidden">
            <div class="dropdown-header">
              <span>Categories</span>
              <button id="addCategoryDropdownBtn" class="dropdown-add" title="Add category">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <line x1="12" y1="5" x2="12" y2="19"/>
                  <line x1="5" y1="12" x2="19" y2="12"/>
                </svg>
              </button>
            </div>
            <div id="categoryDropdownList" class="dropdown-list"></div>
          </div>
        </div>
      </nav>
      
      <div class="sidebar-footer">
        <button id="settingsBtn" class="nav-item" data-tooltip="Settings" title="Settings" aria-label="Settings">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="3"/>
            <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
          </svg>
        </button>
        <button id="exportBtn" class="nav-item" data-tooltip="Export" title="Export" aria-label="Export highlights">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
            <polyline points="7 10 12 15 17 10"/>
            <line x1="12" y1="15" x2="12" y2="3"/>
          </svg>
        </button>
        <button id="importBtn" class="nav-item" data-tooltip="Import" title="Import" aria-label="Import highlights">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
            <polyline points="17 8 12 3 7 8"/>
            <line x1="12" y1="3" x2="12" y2="15"/>
          </svg>
        </button>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="content">
      <!-- Top Bar -->
      <header class="topbar">
        <div class="topbar-left">
          <h1 id="viewTitle">This Page</h1>
          <span class="badge" id="countBadge">0</span>
        </div>
        <div class="topbar-actions">
          <button id="refreshBtn" class="btn-icon" title="Refresh">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="23 4 23 10 17 10"/>
              <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/>
            </svg>
          </button>
        </div>
      </header>

      <!-- Search & Sort Bar -->
      <div class="search-bar">
        <div class="search-input-wrapper">
          <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8"/>
            <path d="m21 21-4.35-4.35"/>
          </svg>
          <input type="text" id="searchInput" class="search-input" placeholder="Search highlights..." aria-label="Search highlights">
          <button id="clearSearchBtn" class="search-clear hidden" title="Clear search">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="18" y1="6" x2="6" y2="18"/>
              <line x1="6" y1="6" x2="18" y2="18"/>
            </svg>
          </button>
        </div>
        <div class="sort-wrapper">
          <button id="sortBtn" class="btn-sort" title="Sort options">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M11 5h10"/>
              <path d="M11 9h7"/>
              <path d="M11 13h4"/>
              <path d="m3 17 3 3 3-3"/>
              <path d="M6 18V4"/>
            </svg>
            <span id="sortLabel">Newest</span>
          </button>
          <div id="sortDropdown" class="sort-dropdown hidden">
            <button class="sort-option active" data-sort="newest">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m3 16 3 3 3-3"/><path d="M6 19V4"/></svg>
              Newest first
            </button>
            <button class="sort-option" data-sort="oldest">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m3 8 3-3 3 3"/><path d="M6 5v15"/></svg>
              Oldest first
            </button>
            <button class="sort-option" data-sort="alpha">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m3 16 3 3 3-3"/><path d="M6 19V4"/><path d="M15 4h5l-5 16h5"/></svg>
              A to Z
            </button>
            <button class="sort-option" data-sort="alpha-desc">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m3 8 3-3 3 3"/><path d="M6 5v15"/><path d="M15 4h5l-5 16h5"/></svg>
              Z to A
            </button>
          </div>
        </div>
      </div>

      <!-- Date Range Filter -->
      <div class="date-filter">
        <button class="date-chip active" data-range="all">All time</button>
        <button class="date-chip" data-range="today">Today</button>
        <button class="date-chip" data-range="week">This week</button>
        <button class="date-chip" data-range="month">This month</button>
      </div>

      <!-- PDF Banner -->
      <div id="pdfBanner" class="pdf-banner hidden">
        <div class="pdf-banner-icon">ðŸ“„</div>
        <div class="pdf-banner-text">
          <strong>PDF detected</strong>
          <span>Open in viewer to highlight</span>
        </div>
        <button id="openPdfViewer" class="pdf-banner-action">Open Viewer</button>
      </div>

      <!-- Filters -->
      <div class="filters">
        <div class="color-pills" id="colorFilterContainer">
          <button class="color-pill active" data-color="all" title="All colors" aria-label="All colors">
            <span class="color-pill-dot all"></span>
            All
          </button>
          <button class="color-pill" data-color="yellow" title="Yellow" aria-label="Yellow highlights">
            <span class="color-pill-dot yellow"></span>
          </button>
          <button class="color-pill" data-color="green" title="Green" aria-label="Green highlights">
            <span class="color-pill-dot green"></span>
          </button>
          <button class="color-pill" data-color="blue" title="Blue" aria-label="Blue highlights">
            <span class="color-pill-dot blue"></span>
          </button>
          <button class="color-pill" data-color="purple" title="Purple" aria-label="Purple highlights">
            <span class="color-pill-dot purple"></span>
          </button>
          <button class="color-pill" data-color="pink" title="Pink" aria-label="Pink highlights">
            <span class="color-pill-dot pink"></span>
          </button>
        </div>
        
        <div class="category-tabs" id="categoryChips">
          <button class="category-tab active" data-category="all">All</button>
        </div>
      </div>

      <!-- Dashboard View (hidden by default) -->
      <div id="dashboardView" class="dashboard hidden">
        <div class="stats-grid">
          <div class="stat-card stat-total">
            <div class="stat-icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 19l7-7 3 3-7 7-3-3z"/>
                <path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"/>
              </svg>
            </div>
            <div class="stat-content">
              <span class="stat-value" id="statTotal">0</span>
              <span class="stat-label">Total Highlights</span>
            </div>
          </div>
          <div class="stat-card stat-favorites">
            <div class="stat-icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
              </svg>
            </div>
            <div class="stat-content">
              <span class="stat-value" id="statFavorites">0</span>
              <span class="stat-label">Favorites</span>
            </div>
          </div>
          <div class="stat-card stat-pages">
            <div class="stat-icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="3" width="7" height="7"/>
                <rect x="14" y="3" width="7" height="7"/>
                <rect x="14" y="14" width="7" height="7"/>
                <rect x="3" y="14" width="7" height="7"/>
              </svg>
            </div>
            <div class="stat-content">
              <span class="stat-value" id="statPages">0</span>
              <span class="stat-label">Pages</span>
            </div>
          </div>
          <div class="stat-card stat-week">
            <div class="stat-icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                <line x1="16" y1="2" x2="16" y2="6"/>
                <line x1="8" y1="2" x2="8" y2="6"/>
                <line x1="3" y1="10" x2="21" y2="10"/>
              </svg>
            </div>
            <div class="stat-content">
              <span class="stat-value" id="statWeek">0</span>
              <span class="stat-label">This Week</span>
            </div>
          </div>
        </div>
        
        <div class="chart-section">
          <h3 class="chart-title">By Color</h3>
          <div class="color-chart" id="colorChart"></div>
        </div>
        
        <div class="chart-section">
          <h3 class="chart-title">Top Categories</h3>
          <div class="category-chart" id="categoryChart"></div>
        </div>
      </div>

      <!-- Highlights List -->
      <div class="highlights-wrapper">
        <div id="highlightsList" class="highlights">
          <!-- Empty State -->
          <div id="emptyState" class="empty">
            <div class="empty-visual">
              <div class="empty-circle"></div>
              <svg class="empty-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <path d="M12 19l7-7 3 3-7 7-3-3z"/>
                <path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"/>
              </svg>
            </div>
            <h3 class="empty-title">No highlights yet</h3>
            <p class="empty-desc">Select text on any page to highlight</p>
          </div>
        </div>
      </div>

      <!-- Footer Actions -->
      <footer class="footer">
        <button id="clearAllBtn" class="btn-clear" disabled>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="3 6 5 6 21 6"/>
            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
          </svg>
          Clear all
        </button>
      </footer>
    </main>
  </div>

  <!-- Ribbon Indicator -->
  <div class="ribbon-toast" id="ribbonIndicator">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
    </svg>
    Quick Mode Active
  </div>

  <!-- Toast -->
  <div id="toast" class="toast hidden"></div>

  <!-- Modals -->
  <!-- Category Modal -->
  <div id="categoryModal" class="modal hidden">
    <div class="modal-overlay"></div>
    <div class="modal-panel">
      <header class="modal-header">
        <h2>Manage Categories</h2>
        <button id="closeCategoryModal" class="modal-close" title="Close" aria-label="Close modal">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"/>
            <line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
        </button>
      </header>
      <div class="modal-content">
        <div class="input-row">
          <input type="text" id="newCategoryInput" placeholder="New category name..." maxlength="30" aria-label="Category name">
          <button id="addCategoryBtn" class="btn-add">Add</button>
        </div>
        <ul id="categoryList" class="category-list"></ul>
      </div>
    </div>
  </div>

  <!-- Export Modal -->
  <div id="exportModal" class="modal hidden">
    <div class="modal-overlay"></div>
    <div class="modal-panel">
      <header class="modal-header">
        <h2>Export</h2>
        <button id="closeExportModal" class="modal-close" title="Close" aria-label="Close modal">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"/>
            <line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
        </button>
      </header>
      <div class="modal-content">
        <p class="modal-desc">Choose categories to export:</p>
        <div id="exportCategoryList" class="checkbox-group"></div>
        <div class="modal-actions">
          <button id="cancelExportBtn" class="btn-secondary">Cancel</button>
          <button id="confirmExportBtn" class="btn-primary">Download JSON</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Import Modal -->
  <div id="importModal" class="modal hidden">
    <div class="modal-overlay"></div>
    <div class="modal-panel">
      <header class="modal-header">
        <h2>Import</h2>
        <button id="closeImportModal" class="modal-close" title="Close" aria-label="Close modal">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"/>
            <line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
        </button>
      </header>
      <div class="modal-content">
        <div class="import-preview">
          <div class="import-preview-row">
            <span class="import-label">File</span>
            <span id="importFileName" class="import-value">-</span>
          </div>
          <div class="import-preview-row">
            <span class="import-label">Items</span>
            <span id="importHighlightCount" class="import-value">-</span>
          </div>
          <div class="import-preview-row">
            <span class="import-label">Exported</span>
            <span id="importExportDate" class="import-value">-</span>
          </div>
        </div>
        <label class="select-label">
          Assign to category
          <select id="importCategorySelect" class="select">
            <option value="">Keep original</option>
            <option value="uncategorized">Uncategorized</option>
          </select>
        </label>
        <div class="modal-actions">
          <button id="cancelImportBtn" class="btn-secondary">Cancel</button>
          <button id="confirmImportBtn" class="btn-primary">Import</button>
        </div>
      </div>
    </div>
  </div>

  <input type="file" id="importFileInput" accept=".json" class="hidden" aria-label="Import JSON file">

  <!-- Settings Modal -->
  <div id="settingsModal" class="modal hidden">
    <div class="modal-overlay"></div>
    <div class="modal-panel">
      <header class="modal-header">
        <h2>Settings</h2>
        <button id="closeSettingsModal" class="modal-close" title="Close" aria-label="Close modal">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"/>
            <line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
        </button>
      </header>
      <div class="modal-content">
        <div class="settings-section">
          <h3 class="settings-title">Display</h3>
          
          <label class="setting-item">
            <span class="setting-label">
              <span class="setting-name">Expand cards by default</span>
              <span class="setting-desc">Show full highlight text when opening popup</span>
            </span>
            <input type="checkbox" id="settingExpandDefault" class="setting-toggle">
          </label>
          
          <label class="setting-item">
            <span class="setting-label">
              <span class="setting-name">Show note preview</span>
              <span class="setting-desc">Display note snippet on collapsed cards</span>
            </span>
            <input type="checkbox" id="settingShowNotePreview" class="setting-toggle" checked>
          </label>
          
          <label class="setting-item">
            <span class="setting-label">
              <span class="setting-name">Show source URL</span>
              <span class="setting-desc">Display website URL in card footer</span>
            </span>
            <input type="checkbox" id="settingShowUrl" class="setting-toggle" checked>
          </label>
        </div>
        
        <div class="settings-section">
          <h3 class="settings-title">Behavior</h3>
          
          <label class="setting-item">
            <span class="setting-label">
              <span class="setting-name">Quick mode effects</span>
              <span class="setting-desc">Enable visual effects when quick mode is on</span>
            </span>
            <input type="checkbox" id="settingQuickModeEffects" class="setting-toggle" checked>
          </label>
          
          <label class="setting-item">
            <span class="setting-label">
              <span class="setting-name">Confirm before delete</span>
              <span class="setting-desc">Ask confirmation before deleting highlights</span>
            </span>
            <input type="checkbox" id="settingConfirmDelete" class="setting-toggle">
          </label>
        </div>
        
        <div class="settings-section">
          <h3 class="settings-title">Default highlight color</h3>
          <div class="color-picker-row">
            <button class="color-pick active" data-color="#ffd43b" style="background: #ffd43b" title="Yellow"></button>
            <button class="color-pick" data-color="#51cf66" style="background: #51cf66" title="Green"></button>
            <button class="color-pick" data-color="#4dabf7" style="background: #4dabf7" title="Blue"></button>
            <button class="color-pick" data-color="#9775fa" style="background: #9775fa" title="Purple"></button>
            <button class="color-pick" data-color="#ff6ba7" style="background: #ff6ba7" title="Pink"></button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="ribbons.js"></script>
  <script src="splashCursor.js"></script>
  <script src="popup.js" type="module"></script>
</body>
</html>
